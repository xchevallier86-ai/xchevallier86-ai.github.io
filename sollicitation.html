<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Sollicitation</title>
  <style>
    body {
      font-family: Calibri, Arial, sans-serif; /* Police mise à jour pour correspondre aux images */
      margin: 0;
      background: #f9f9f9;
      color: #333;
    }
    /* Barre de navigation */
    nav {
      background: #007BFF;
      padding: 12px 20px;
      color: white;
      font-weight: bold;
      font-size: 18px;
    }
    nav a {
      color: white;
      margin-right: 20px;
      text-decoration: none;
    }
    nav a:hover {
      text-decoration: underline;
    }
    .container {
      padding: 20px;
    }
    h1 {
      text-align: center;
      margin-bottom: 5px;
    }
    .subtitle {
      text-align: center;
      font-size: 22px;
      font-weight: bold;
      margin-bottom: 20px;
    }
    .form-info {
      margin: 20px auto;
      display: flex;
      justify-content: center;
      gap: 20px;
    }
    .form-info label {
      font-weight: bold;
    }
    .block {
      margin: 30px 0;
      padding: 20px;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    /* Style des titres de section mis à jour */
    .block h2 {
        font-size: 1.2em;
        font-weight: bold;
        text-decoration: underline;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
    }
    .block h2 input {
        margin-left: 15px;
        width: 18px;
        height: 18px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    th, td {
      border: 1px solid #000; /* Bordure plus marquée comme sur les images */
      padding: 8px;
      text-align: left; /* Alignement par défaut à gauche */
      vertical-align: middle;
    }
    th {
      background: #f2f2f2;
      font-weight: normal;
    }
    .centered {
        text-align: center;
    }
    /* Nouveaux styles pour les sections de tableau */
    .section-title {
        font-weight: bold;
        text-align: center;
        background-color: #E0E0E0;
    }
    .facultatif-body {
        background-color: #F0F8FF;
    }
    .fondamentaux-row {
        background-color: #DDEBF7;
    }
    input[type="text"] {
      width: 95%;
      padding: 4px;
    }
    input[type="checkbox"] {
        width: 16px;
        height: 16px;
    }
    .btn-submit {
      display: block;
      margin: 30px auto;
      padding: 12px 20px;
      font-size: 16px;
      background: #007BFF;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .btn-submit:hover {
      background: #0056b3;
    }
  </style>
</head>
<body>

<nav>
  <a href="index.html">Accueil</a>
  <a href="sollicitation.html">Sollicitations</a>
  <a href="documentation.html">Documentation & Ressources</a>
</nav>

<div class="container">
  <h1>Sollicitations</h1>
  <div class="subtitle">FI APM XX</div>

  <div class="form-info">
    <div>
      <label for="nom">Nom : </label>
      <input type="text" id="nom" name="nom">
    </div>
    <div>
      <label for="prenom">Prénom : </label>
      <input type="text" id="prenom" name="prenom">
    </div>
  </div>

<div class="block">
    <h2>Référent Professionnel <input type="checkbox"></h2>
    <table>
        <thead>
            <tr>
                <td colspan="6" class="section-title">Obligatoire</td>
            </tr>
            <tr>
                <th style="width:10%;">Date</th>
                <th style="width:10%;">Séquence</th>
                <th>Intitulé ( Horaires )</th>
                <th style="width:10%;" class="centered">Durée</th>
                <th style="width:10%;" class="centered">Disponibilité</th>
                <th style="width:15%;">Commentaire</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><input type="text" placeholder="Date..."></td>
                <td>F0</td>
                <td>Ouverture de la promotion</td>
                <td class="centered">1</td>
                <td class="centered"><input type="checkbox"></td>
                <td><input type="text"></td>
            </tr>
            <tr>
                <td><input type="text" placeholder="Date..."></td>
                <td>F1.1</td>
                <td>Représentation du métier d'APM</td>
                <td class="centered">1</td>
                <td class="centered"><input type="checkbox"></td>
                <td><input type="text"></td>
            </tr>
            <tr>
                <td><input type="text" placeholder="Date..."></td>
                <td>F1.2</td>
                <td>Déontologie</td>
                <td class="centered">1</td>
                <td class="centered"><input type="checkbox"></td>
                <td><input type="text"></td>
            </tr>
             <tr>
                <td rowspan="3"><input type="text" placeholder="Date..."></td>
                <td rowspan="3">Mises en Situation</td>
                <td>MSP S1</td>
                <td rowspan="3"></td>
                <td rowspan="3" class="centered"><input type="checkbox"></td>
                <td rowspan="3"><input type="text"></td>
            </tr>
            <tr>
                <td>MSP S3</td>
            </tr>
            <tr>
                <td>MSP Intermédiaires et Finales</td>
            </tr>
        </tbody>
        <thead>
            <tr>
                <td colspan="6" class="section-title">Facultatif</td>
            </tr>
        </thead>
        <tbody class="facultatif-body">
            <tr>
                <td><input type="text" placeholder="Date..."></td>
                <td>S1.1</td>
                <td>Renseigner sur la VP et au Poste</td>
                <td class="centered">2</td>
                <td class="centered"><input type="checkbox"></td>
                <td><input type="text"></td>
            </tr>
            <tr>
                <td><input type="text" placeholder="Date..."></td>
                <td>S1.2</td>
                <td>Communication avec public spécifique</td>
                <td class="centered">2</td>
                <td class="centered"><input type="checkbox"></td>
                <td><input type="text"></td>
            </tr>
            <tr>
                <td><input type="text" placeholder="Date..."></td>
                <td>S1.3</td>
                <td>Assister une personne en difficulté</td>
                <td class="centered">3</td>
                <td class="centered"><input type="checkbox"></td>
                <td><input type="text"></td>
            </tr>
            <tr>
                <td><input type="text" placeholder="Date..."></td>
                <td>S1.4</td>
                <td>Gérer une situation conflictuelle</td>
                <td class="centered">2</td>
                <td class="centered"><input type="checkbox"></td>
                <td><input type="text"></td>
            </tr>
        </tbody>
    </table>
</div>

<div class="block">
    <h2>Référent Relationnel <input type="checkbox"></h2>
    <table>
        <thead>
            <tr>
                <td colspan="6" class="section-title">Obligatoire</td>
            </tr>
            <tr>
                <th style="width:10%;">Date</th>
                <th style="width:10%;">Séquence</th>
                <th>Intitulé</th>
                <th style="width:10%;" class="centered">Durée</th>
                <th style="width:10%;" class="centered">Disponibilité</th>
                <th style="width:15%;">Commentaire</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><input type="text" placeholder="Date..."></td>
                <td>F1.3</td>
                <td>Communication</td>
                <td class="centered">1</td>
                <td class="centered"><input type="checkbox"></td>
                <td><input type="text"></td>
            </tr>
            <tr>
                <td><input type="text" placeholder="Date..."></td>
                <td>F1.4</td>
                <td>Gestion des émotions</td>
                <td class="centered">1</td>
                <td class="centered"><input type="checkbox"></td>
                <td><input type="text"></td>
            </tr>
            <tr>
                <td><input type="text" placeholder="Date..."></td>
                <td>S1.2</td>
                <td>Communication avec public spécifique (binôme PM)</td>
                <td class="centered">2</td>
                <td class="centered"><input type="checkbox"></td>
                <td><input type="text"></td>
            </tr>
            <tr>
                <td><input type="text" placeholder="Date..."></td>
                <td>S1.3</td>
                <td>Assister une personne en difficulté (binôme PM)</td>
                <td class="centered">3</td>
                <td class="centered"><input type="checkbox"></td>
                <td><input type="text"></td>
            </tr>
            <tr>
                <td rowspan="3"><input type="text" placeholder="Date..."></td>
                <td rowspan="3">Mises en Situation</td>
                <td>MSP S1 (9h - 17h)</td>
                <td rowspan="3" class="centered">4</td>
                <td rowspan="3" class="centered"><input type="checkbox"></td>
                <td rowspan="3"><input type="text"></td>
            </tr>
            <tr>
                <td>MSP S3 ( 9h - 17h + 8h30 - 12h)</td>
            </tr>
            <tr>
                <td>MSP Intermédiaires (9h - 17h) et Finales (13h - 18h + 9h - 17h)</td>
            </tr>
        </tbody>
        <thead>
            <tr>
                <td colspan="6" class="section-title">Facultatif (en binôme avec un PM)</td>
            </tr>
        </thead>
        <tbody class="facultatif-body">
            <tr>
                <td><input type="text" placeholder="Date..."></td>
                <td>S1.1</td>
                <td>Renseigner sur la VP et au Poste</td>
                <td class="centered">2</td>
                <td class="centered"><input type="checkbox"></td>
                <td><input type="text"></td>
            </tr>
            <tr>
                <td><input type="text" placeholder="Date..."></td>
                <td>S1.4</td>
                <td>Gérer une situation conflictuelle</td>
                <td class="centered">2</td>
                <td class="centered"><input type="checkbox"></td>
                <td><input type="text"></td>
            </tr>
        </tbody>
    </table>
</div>


<div class="block">
    <h2>Référent Technique <input type="checkbox"></h2>
    <table>
        <thead>
            <tr>
                <td colspan="6" class="section-title">Obligatoire</td>
            </tr>
            <tr>
                <th style="width:10%;">Date</th>
                <th style="width:10%;">Séquence</th>
                <th>Intitulé ( Horaires )</th>
                <th style="width:10%;" class="centered">Durée</th>
                <th style="width:10%;" class="centered">Disponibilité</th>
                <th style="width:15%;">Commentaire</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><input type="text" placeholder="Date..."></td>
                <td>F4.3</td>
                <td>GTPI</td>
                <td class="centered">1</td>
                <td class="centered"><input type="checkbox"></td>
                <td><input type="text"></td>
            </tr>
            <tr>
                <td><input type="text" placeholder="Date..."></td>
                <td>Mises en Situation</td>
                <td>MSP S3</td>
                <td class="centered">1</td>
                <td class="centered"><input type="checkbox"></td>
                <td><input type="text"></td>
            </tr>
             <tr>
                <td rowspan="3"><input type="text" placeholder="Date..."></td>
                <td rowspan="3">Mises en Situation</td>
                <td>MSP Intermediaire</td>
                <td rowspan="3"></td>
                <td rowspan="3" class="centered"><input type="checkbox"></td>
                <td rowspan="3"><input type="text"></td>
            </tr>
             <tr>
                <td rowspan="3"><input type="text" placeholder="Date..."></td>
                <td rowspan="3">Mises en Situation</td>
                <td>MSP Finales</td>
                <td rowspan="3"></td>
                <td rowspan="3" class="centered"><input type="checkbox"></td>
                <td rowspan="3"><input type="text"></td>
            </tr>
        </tbody>
        <thead>
            <tr>
                <td colspan="6" class="section-title">Facultatif</td>
            </tr>
        </thead>
        <tbody class="facultatif-body">
            <tr>
                <td><input type="text" placeholder="Date..."></td>
                <td>F4.1</td>
                <td>Sport</td>
                <td class="centered">2</td>
                <td class="centered"><input type="checkbox"></td>
                <td><input type="text"></td>
            </tr>
            <tr>
                <td><input type="text" placeholder="Date..."></td>
                <td>F4.2</td>
                <td>Moyen de Transmission</td>
                <td class="centered">2</td>
                <td class="centered"><input type="checkbox"></td>
                <td><input type="text"></td>
            </tr>
        </tbody>
    </table>
</div>

<div class="block">
    <h2>Fondamentaux</h2>
    <table>
        <tbody>
            <tr>
                <td><input type="text" placeholder="Date..."></td>
                <td>F2.1</td>
                <td>GTPI</td>
                <td class="centered">1</td>
                <td class="centered"><input type="checkbox"></td>
                <td><input type="text"></td>
            </tr>
            <tr>
                <td><input type="text" placeholder="Date..."></td>
                <td>F2.2</td>
                <td>Organisation administrative et juridictionnellle française</td>
                <td class="centered">1</td>
                <td class="centered"><input type="checkbox"></td>
                <td><input type="text"></td>
            </tr>
            <tr>
                <td><input type="text" placeholder="Date..."></td>
                <td>F2.3</td>
                <td>Statut du PM</td>
                <td class="centered">1</td>
                <td class="centered"><input type="checkbox"></td>
                <td><input type="text"></td>
            </tr>
            <tr>
                <td><input type="text" placeholder="Date..."></td>
                <td>F3.1</td>
                <td>Les textes régissant les prérogatives du PM</td>
                <td class="centered">1</td>
                <td class="centered"><input type="checkbox"></td>
                <td><input type="text"></td>
            </tr>
            <tr>
                <td><input type="text" placeholder="Date..."></td>
                <td>F3.2</td>
                <td>Droit Pénal et Code de Procédure Pénale</td>
                <td class="centered">1</td>
                <td class="centered"><input type="checkbox"></td>
                <td><input type="text"></td>
            </tr>
            <tr>
                <td><input type="text" placeholder="Date..."></td>
                <td>F3.3</td>
                <td>Les écrits Professionnel</td>
                <td class="centered">1</td>
                <td class="centered"><input type="checkbox"></td>
                <td><input type="text"></td>
            </tr>
            <tr>
                <td><input type="text" placeholder="Date..."></td>
                <td>F3.4</td>
                <td>Les infractions liées au bruit de voisinage</td>
                <td class="centered">1</td>
                <td class="centered"><input type="checkbox"></td>
                <td><input type="text"></td>
            </tr>
            <tr>
                <td><input type="text" placeholder="Date..."></td>
                <td>F3.5</td>
                <td>Module juridique préalable à l'armement</td>
                <td class="centered">1</td>
                <td class="centered"><input type="checkbox"></td>
                <td><input type="text"></td>
            </tr>
            <tr>
                <td><input type="text" placeholder="Date..."></td>
                <td>F4.1</td>
                <td>Sport</td>
                <td class="centered">1</td>
                <td class="centered"><input type="checkbox"></td>
                <td><input type="text"></td>
            </tr>
            <tr>
                <td><input type="text" placeholder="Date..."></td>
                <td>F4.2</td>
                <td>Les moyens de transmission</td>
                <td class="centered">1</td>
                <td class="centered"><input type="checkbox"></td>
                <td><input type="text"></td>
            </tr>
            <tr>
                <td><input type="text" placeholder="Date..."></td>
                <td>F4.4</td>
                <td>SST</td>
                <td class="centered">1</td>
                <td class="centered"><input type="checkbox"></td>
                <td><input type="text"></td>
            </tr>
        </tbody>
    </table>
</div>

<div class="block">
    <h2>Situations</h2>
    <table>
        <tbody>
            <tr>
                <td><input type="text" placeholder="Date..."></td>
                <td>S1.1</td>
                <td>Accueillir et renseigner au poste et sur la VP</td>
                <td class="centered">2</td>
                <td class="centered"><input type="checkbox"></td>
                <td><input type="text"></td>
            </tr>
            <tr>
                <td><input type="text" placeholder="Date..."></td>
                <td>S2.2</td>
                <td>Communication avec les publics spécifiques</td>
                <td class="centered">1</td>
                <td class="centered"><input type="checkbox"></td>
                <td><input type="text"></td>
            </tr>
            <tr>
                <td><input type="text" placeholder="Date..."></td>
                <td>S2.3</td>
                <td>Assister une personne en difficulté</td>
                <td class="centered">1</td>
                <td class="centered"><input type="checkbox"></td>
                <td><input type="text"></td>
            </tr>
            <tr>
                <td><input type="text" placeholder="Date..."></td>
                <td>S1.4</td>
                <td>Intervenir sur une situation conflictuelle</td>
                <td class="centered">1</td>
                <td class="centered"><input type="checkbox"></td>
                <td><input type="text"></td>
            </tr>
            <tr>
                <td><input type="text" placeholder="Date..."></td>
                <td>S1.5</td>
                <td>Intervenir en situation de crise ou d'urgence</td>
                <td class="centered">1</td>
                <td class="centered"><input type="checkbox"></td>
                <td><input type="text"></td>
            </tr>
            <tr>
                <td><input type="text" placeholder="Date..."></td>
                <td>S2.1</td>
                <td>Les règles de fonctionnement d'un poste de police</td>
                <td class="centered">1</td>
                <td class="centered"><input type="checkbox"></td>
                <td><input type="text"></td>
            </tr>
            <tr>
                <td><input type="text" placeholder="Date..."></td>
                <td>S2.2</td>
                <td>Maintenir en état les moyens individuels et collectifs</td>
                <td class="centered">1</td>
                <td class="centered"><input type="checkbox"></td>
                <td><input type="text"></td>
            </tr>
            <tr>
                <td><input type="text" placeholder="Date..."></td>
                <td>S2.3</td>
                <td>Maintenir ses compétences professionnelles</td>
                <td class="centered">1</td>
                <td class="centered"><input type="checkbox"></td>
                <td><input type="text"></td>
            </tr>
            <tr>
                <td><input type="text" placeholder="Date..."></td>
                <td>S3.1</td>
                <td>Initier une procédure judiciaire</td>
                <td class="centered">1</td>
                <td class="centered"><input type="checkbox"></td>
                <td><input type="text"></td>
            </tr>
            <tr>
                <td><input type="text" placeholder="Date..."></td>
                <td>S3.2</td>
                <td>La réglementation relative au Code de la Route</td>
                <td class="centered">1</td>
                <td class="centered"><input type="checkbox"></td>
                <td><input type="text"></td>
            </tr>
            <tr>
                <td><input type="text" placeholder="Date..."></td>
                <td>S3.3.1</td>
                <td>Les pouvoirs de police du maire</td>
                <td class="centered">2</td>
                <td class="centered"><input type="checkbox"></td>
                <td><input type="text"></td>
            </tr>
            <tr>
                <td><input type="text" placeholder="Date..."></td>
                <td>S3.3.2</td>
                <td>Occupation du domaine public</td>
                <td class="centered">2</td>
                <td class="centered"><input type="checkbox"></td>
                <td><input type="text"></td>
            </tr>
            <tr>
                <td><input type="text" placeholder="Date..."></td>
                <td>S3.3.3</td>
                <td>Urbanisme et Publicité</td>
                <td class="centered">1</td>
                <td class="centered"><input type="checkbox"></td>
                <td><input type="text"></td>
            </tr>
            <tr>
                <td><input type="text" placeholder="Date..."></td>
                <td>S3.3.4</td>
                <td>Environnement</td>
                <td class="centered">1</td>
                <td class="centered"><input type="checkbox"></td>
                <td><input type="text"></td>
            </tr>
            <tr>
                <td><input type="text" placeholder="Date..."></td>
                <td>S3.3.5</td>
                <td>Réglementation Animale</td>
                <td class="centered">1</td>
                <td class="centered"><input type="checkbox"></td>
                <td><input type="text"></td>
            </tr>
            <tr>
                <td><input type="text" placeholder="Date..."></td>
                <td>S3.3.1</td>
                <td>Funéraire</td>
                <td class="centered">0,5</td>
                <td class="centered"><input type="checkbox"></td>
                <td><input type="text"></td>
            </tr>
            <tr>
                <td><input type="text" placeholder="Date..."></td>
                <td>S4.1</td>
                <td>Prévention et surveillance du domaine public</td>
                <td class="centered">3</td>
                <td class="centered"><input type="checkbox"></td>
                <td><input type="text"></td>
            </tr>
            <tr>
                <td><input type="text" placeholder="Date..."></td>
                <td>S4.2</td>
                <td>Participer et assurer le bon déroulement des cérémonies et manifestations</td>
                <td class="centered">2</td>
                <td class="centered"><input type="checkbox"></td>
                <td><input type="text"></td>
            </tr>
        </tbody>
    </table>
</div>
<button class="btn-submit" id="submitBtn">Enregistrer</button>

<script>
  const EDGE_FUNCTION_URL = "https://<ton-projet>.functions.supabase.co/sollicitations"; 
  // remplace <ton-projet> par ton id Supabase

  document.getElementById("submitBtn").addEventListener("click", async () => {
    const nom = document.getElementById("nom").value.trim();
    const prenom = document.getElementById("prenom").value.trim();
    const fi = document.querySelector(".subtitle").innerText.trim(); // FI affiché en haut de la page

    if (!nom || !prenom || !fi) {
      alert("Merci de renseigner le nom, le prénom et la FI");
      return;
    }

    // Récupérer toutes les lignes de tableaux
    const rows = document.querySelectorAll("table tbody tr");

    // Construire les objets à envoyer
    let allData = [];
    rows.forEach(row => {
      const cells = row.querySelectorAll("td");

      if (cells.length >= 6) {
        const date = cells[0].querySelector("input")?.value || null;
        const sequence = cells[1]?.innerText || cells[1]?.querySelector("input")?.value || null;
        const intitule = cells[2]?.innerText || cells[2]?.querySelector("input")?.value || null;
        const duree = cells[3]?.innerText || cells[3]?.querySelector("input")?.value || null;
        const dispo = cells[4].querySelector("input[type=checkbox]")?.checked || false; // Toujours un booléen
        const com = cells[5].querySelector("input")?.value || null;

        // Ne rien enregistrer si ligne complètement vide
        if (date || intitule || com || dispo) {
          allData.push({
            fi,
            nom,
            prenom,
            date,
            sequence,
            intitule,
            duree,
            dispo,
            com
          });
        }
      }
    });

    if (allData.length === 0) {
      alert("Aucune donnée à enregistrer");
      return;
    }

    // Envoi à la fonction edge
    let force = false;
    let response = await fetch(EDGE_FUNCTION_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ ...allData[0], force }) // on envoie la première pour vérifier doublon
    });
    let result = await response.json();

    if (result.duplicate) {
      if (confirm(result.message)) {
        force = true;
      } else {
        return;
      }
    }

    // Envoi de toutes les lignes (avec force si nécessaire)
    for (let rowData of allData) {
      await fetch(EDGE_FUNCTION_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ ...rowData, force })
      });
    }

    alert("Vos choix ont été enregistrés !");
  });
</script>
</body>
